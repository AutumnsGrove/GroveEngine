# Email Render Worker
#
# Stateless worker that renders Grove email templates on demand.
# Called by the catch-up cron and can be used for previews.
#
# Setup: bun install && bun run sync-templates
# Deploy: bun run deploy
# Test: curl -X POST https://grove-email-render.<account>.workers.dev/render \
#       -H "Content-Type: application/json" \
#       -d '{"template":"WelcomeEmail","audienceType":"wanderer"}'

name = "grove-email-render"
main = "src/worker.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# Sync templates before wrangler bundles
[build]
command = "node scripts/sync-templates.mjs"

# Custom domain (optional)
# routes = [{ pattern = "email-render.grove.place", custom_domain = true }]
